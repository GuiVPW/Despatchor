# Migration `20201030184138-new-database`

This migration has been generated by Xubili at 10/30/2020, 3:41:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"email" text   NOT NULL ,
"password" text   NOT NULL ,
"name" text   ,
"avatarUrl" text   ,
"bio" text   ,
"verifiedEmail" boolean   NOT NULL DEFAULT false,
"updatedAt" timestamp(3)   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Post" (
"id" text   NOT NULL ,
"title" text   NOT NULL ,
"description" text   ,
"published" boolean   NOT NULL DEFAULT false,
"authorId" text   NOT NULL ,
"postImageUrl" text   ,
"likes" integer   NOT NULL DEFAULT 0,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."PostsLike" (
"id" text   NOT NULL ,
"postId" text   NOT NULL ,
"userId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Comment" (
"id" text   NOT NULL ,
"authorId" text   NOT NULL ,
"postId" text   NOT NULL ,
"comment" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Chat" (
"id" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Message" (
"id" text   NOT NULL ,
"body" text   NOT NULL ,
"createdById" text   NOT NULL ,
"chatId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ChatOnUser" (
"chatId" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("chatId","userId")
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.name_unique" ON "public"."User"("name")

CREATE UNIQUE INDEX "Post.authorId_unique" ON "public"."Post"("authorId")

CREATE UNIQUE INDEX "PostsLike.userId_unique" ON "public"."PostsLike"("userId")

CREATE UNIQUE INDEX "Comment.authorId_unique" ON "public"."Comment"("authorId")

ALTER TABLE "public"."Post" ADD FOREIGN KEY("authorId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PostsLike" ADD FOREIGN KEY("postId")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PostsLike" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("authorId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("postId")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY("chatId")REFERENCES "public"."Chat"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ChatOnUser" ADD FOREIGN KEY("chatId")REFERENCES "public"."Chat"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ChatOnUser" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201018053744-added-post---comment-author-id-fields-as--unique..20201030184138-new-database
--- datamodel.dml
+++ datamodel.dml
@@ -1,54 +1,85 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id            Int         @id @default(autoincrement())
-  email         String      @unique
+  id            String       @id @default(uuid())
+  email         String       @unique
   password      String
-  name          String?
+  name          String?      @unique
   avatarUrl     String?
   posts         Post[]
   comment       Comment[]
   bio           String?
   liked         PostsLike[]
-  verifiedEmail Boolean     @default(false)
-  createdAt     DateTime    @default(now())
+  verifiedEmail Boolean      @default(false)
+  updatedAt     DateTime     @updatedAt
+  createdAt     DateTime     @default(now())
+  sentMessages  Message[]
+  chats         ChatOnUser[]
 }
 model Post {
-  id           Int         @id @default(autoincrement())
+  id           String      @id @default(uuid())
   title        String
   description  String?
   published    Boolean     @default(false)
-  authorId     Int         @unique
+  authorId     String      @unique
   author       User        @relation(fields: [authorId], references: [id])
   postImageUrl String?
   comment      Comment[]
   likes        Int         @default(0)
   likers       PostsLike[]
   createdAt    DateTime    @default(now())
+  updatedAt    DateTime    @updatedAt
 }
 model PostsLike {
-  id     Int  @id @default(autoincrement())
-  postId Int
-  post   Post @relation(fields: [postId], references: [id])
-  userId Int  @unique
-  user   User @relation(fields: [userId], references: [id])
+  id        String   @id @default(uuid())
+  postId    String
+  post      Post     @relation(fields: [postId], references: [id])
+  userId    String   @unique
+  user      User     @relation(fields: [userId], references: [id])
+  createdAt DateTime @default(now())
 }
 model Comment {
-  id        Int      @id @default(autoincrement())
+  id        String   @id @default(uuid())
   author    User     @relation(fields: [authorId], references: [id])
-  authorId  Int      @unique
+  authorId  String   @unique
   post      Post     @relation(fields: [postId], references: [id])
-  postId    Int
+  postId    String
   comment   String
   createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
 }
+
+model Chat {
+  id       String       @id @default(uuid())
+  users    ChatOnUser[]
+  messages Message[]
+}
+
+model Message {
+  id          String   @id @default(uuid())
+  body        String
+  createdBy   User     @relation(fields: [createdById], references: [id])
+  createdById String
+  chat        Chat     @relation(fields: [chatId], references: [id])
+  chatId      String
+  createdAt   DateTime @default(now())
+}
+
+model ChatOnUser {
+  chat   Chat   @relation(fields: [chatId], references: [id])
+  chatId String
+  user   User   @relation(fields: [userId], references: [id])
+  userId String
+
+  @@id([chatId, userId])
+}
```


